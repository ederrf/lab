<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3rd-Party Payment Status Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #020617;
      --card-bg: #020617;
      --border: #1f2937;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --green: #10b981;
      --gray: #4b5563;
      --yellow: #facc15;
      --red: #f97373;
      --font: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: var(--font);
      background: radial-gradient(circle at top, #1e293b 0, #020617 55%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .app {
      width: 100%;
      max-width: 900px;
    }

    h1 {
      margin: 0 0 0.25rem;
      font-size: 1.75rem;
      letter-spacing: 0.03em;
    }

    .subtitle {
      margin: 0 0 1.5rem;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 1rem;
    }

    .service-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.03), transparent);
      border-radius: 0.9rem;
      border: 1px solid var(--border);
      padding: 0.9rem 1rem;
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.35);
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .service-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
    }

    .service-name {
      font-weight: 600;
      font-size: 1rem;
      white-space: nowrap;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.15rem 0.6rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      border: 1px solid transparent;
    }

    .status-pill--loading {
      background: rgba(148, 163, 184, 0.1);
      border-color: rgba(148, 163, 184, 0.4);
      color: var(--muted);
    }

    .status-pill--ok {
      background: rgba(16, 185, 129, 0.12);
      border-color: rgba(16, 185, 129, 0.7);
      color: var(--green);
    }

    .status-pill--unknown {
      background: rgba(75, 85, 99, 0.18);
      border-color: rgba(75, 85, 99, 0.8);
      color: var(--muted);
    }

    .status-pill--issue {
      background: rgba(234, 179, 8, 0.15);
      border-color: rgba(234, 179, 8, 0.7);
      color: var(--yellow);
    }

    .status-pill--critical {
      background: rgba(239, 68, 68, 0.15);
      border-color: rgba(239, 68, 68, 0.8);
      color: var(--red);
    }

    .status-description {
      font-size: 0.8rem;
      color: var(--muted);
      min-height: 1.2em;
    }

    .status-link {
      margin-top: 0.2rem;
      font-size: 0.8rem;
      text-decoration: none;
      color: #38bdf8;
    }

    .status-link:hover {
      text-decoration: underline;
    }

    .footer-note {
      margin-top: 1rem;
      font-size: 0.75rem;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Payment Provider Status</h1>
      <p class="subtitle">
        Green = overall service healthy. Gray = issues/maintenance/unknown (or non-JSON status pages).
      </p>
    </header>

    <main class="grid" id="services-grid">
      <!-- Cards injected via JS -->
    </main>

    <p class="footer-note">
      Data is fetched via a Cloudflare Worker proxy that reads each provider's status page (Statuspage <code>/api/v2/status.json</code> where available).
    </p>
  </div>

  <script>
    // ðŸ”´ TODO: replace with your real Worker base URL (no trailing slash)
    const WORKER_BASE_URL = "https://status.ederribeiro.workers.dev";

    const services = [
      {
        id: "affirm",
        name: "Affirm",
        statusPageUrl: "https://status.affirm.com/"
      },
      {
        id: "afterpay",
        name: "Afterpay",
        statusPageUrl: "https://status.afterpay.com/"
      },
      {
        id: "cybersource",
        name: "Cybersource",
        statusPageUrl: "https://status.cybersource.com/"
      },
      {
        id: "paypal",
        name: "PayPal (Production)",
        statusPageUrl: "https://www.paypal-status.com/product/production"
      },
      {
        id: "klarna",
        name: "Klarna",
        statusPageUrl: "https://status.klarna.com/"
      },
      {
        id: "stripe",
        name: "Stripe",
        statusPageUrl: "https://status.stripe.com/"
      },
      {
        id: "paysafe",
        name: "Paysafe",
        statusPageUrl: "https://status.paysafe.com/"
      },
      {
        id: "fiserv",
        name: "Fiserv Client Alerts",
        statusPageUrl: "https://merchants.fiserv.com/en-us/customer-center/client-alerts/"
      }
    ];

    const grid = document.getElementById("services-grid");

    function createServiceCard(service) {
      const card = document.createElement("article");
      card.className = "service-card";
      card.id = `service-${service.id}`;

      card.innerHTML = `
        <div class="service-header">
          <span class="service-name">${service.name}</span>
          <span class="status-pill status-pill--loading" data-role="pill">
            Loadingâ€¦
          </span>
        </div>
        <div class="status-description" data-role="description"></div>
        <a class="status-link" href="${service.statusPageUrl}" target="_blank" rel="noopener noreferrer">
          View full status page â†’
        </a>
      `;

      grid.appendChild(card);
      return card;
    }

    function setPillState(card, state) {
      const pill = card.querySelector('[data-role="pill"]');
      const desc = card.querySelector('[data-role="description"]');
      pill.className = "status-pill";

      switch (state.state) {
        case "ok":
          pill.classList.add("status-pill--ok");
          pill.textContent = "Healthy";
          break;
        case "issue":
          pill.classList.add("status-pill--issue");
          pill.textContent = "Issues";
          break;
        case "critical":
          pill.classList.add("status-pill--critical");
          pill.textContent = "Major outage";
          break;
        case "unknown":
        default:
          pill.classList.add("status-pill--unknown");
          pill.textContent = "Unknown";
          break;
      }

      desc.textContent = state.description || "";
    }

    async function fetchStatus(service) {
      const card = createServiceCard(service);
      const url = `${WORKER_BASE_URL}/status/${encodeURIComponent(service.id)}`;

      try {
        const res = await fetch(url);
        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }

        const contentType = res.headers.get("content-type") || "";

        if (contentType.includes("application/json")) {
          const data = await res.json();

          // Try Atlassian Statuspage format: { status: { indicator, description } }
          if (data && data.status && typeof data.status.indicator === "string") {
            const indicator = data.status.indicator.toLowerCase();
            const description = data.status.description || "";

            let state = { state: "unknown", description };

            if (indicator === "none") {
              state.state = "ok";
            } else if (indicator === "minor" || indicator === "maintenance") {
              state.state = "issue";
            } else if (indicator === "major" || indicator === "critical") {
              state.state = "critical";
            } else {
              state.state = "unknown";
            }

            setPillState(card, state);
          } else {
            // JSON but not Statuspage shape â€“ mark unknown, show something generic
            setPillState(card, {
              state: "unknown",
              description: "Non-standard JSON status format. See status page for details."
            });
          }
        } else {
          // HTML or other â€“ e.g. Fiserv client alerts
          const text = await res.text();
          setPillState(card, {
            state: "unknown",
            description: "Non-JSON status page (likely HTML alerts). Open status page for details."
          });
        }
      } catch (err) {
        setPillState(card, {
          state: "unknown",
          description: "Could not determine status (proxy/API error). Check the status page directly."
        });
        console.warn("Failed to fetch status for", service.name, err);
      }
    }

    (function init() {
      services.forEach(fetchStatus);
    })();
  </script>
</body>
</html>
